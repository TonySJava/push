<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 指定工作空间，要与接口名相同，源代码没有去看，猜测应该是通过"这里的namespace.下边方法的id"来定位方法的 -->
<mapper namespace="com.jjbike.mapper.IPushInfo">
    <sql id="PushInfoColumns">
        p.id AS "id",
        p.DeviceToken AS "deviceToken",
        p.addtime AS "addtime",
        p.userId AS "userId",
        p.create_by AS "creator",
        p.create_date AS "createDate",
        p.update_by AS "updater",
        p.update_date AS "updateDate",
        p.del_flag AS "pDelFlag",
        g.group_tag AS "groupTag",
        g.group_name AS "groupName",
        g.del_flag AS "gDelFlag",
        u.del_flag AS "uDelFlag",
        u.push_group_id AS "pushGroupId"
    </sql>

    <sql id="PushColumns">
        p.DeviceToken AS "deviceToken"
    </sql>
    <!--SELECT p.DeviceToken FROM t_push_info p where p.id in-->
    <!--(SELECT u.push_info_id from t_push_group_user u where u.push_group_id in-->
    <!--(SELECT g.id from t_push_group_team g where g.group_name='新用户'));-->
    <select id="selectListByConditions" parameterType="java.lang.String" resultType="com.jjbike.entity.push.PushInfo">
    SELECT <include refid="PushColumns"/>
        FROM t_push_info p
        WHERE p.id IN (
        SELECT u.push_info_id FROM t_push_group_user u
        WHERE u.push_group_id IN (
        SELECT g.id FROM t_push_group_team g WHERE
        (1=1)
        <if test="groupName !=null and groupName !='' ">
            AND g.group_name =#{groupName}
        </if>
        <if test="groupTag !=null and groupTag !='' ">
            AND g.group_tag =#{groupTag}
        </if>
        AND g.del_flag=0
        )
        AND u.del_flag=0
        ) AND p.del_flag=0;

    </select>

</mapper>